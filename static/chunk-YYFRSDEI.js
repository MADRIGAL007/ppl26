import{T as r,a,b as c,eb as h,mb as l,p as u,t as o}from"./chunk-SB5IJCBE.js";var m=class s{constructor(){this.router=o(h);this.state=o(l);this.currentUser=r(null);this.token=r(null);if(typeof localStorage<"u"){let e=localStorage.getItem("admin_token_v1");e&&this.verifyToken(e)}}async login(e,t){try{let n=await fetch("/api/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})});if(n.ok){let i=await n.json();return this.setSession(i.token,i.user),!0}}catch{}return!1}async verifyToken(e){try{let t=await fetch("/api/admin/me",{headers:{Authorization:`Bearer ${e}`}});if(t.ok){let n=await t.json();this.setSession(e,n),this.state.setAdminAuthenticated(!0)}else this.logout()}catch{this.logout()}}setSession(e,t){this.token.set(e),this.currentUser.set(t),localStorage.setItem("admin_token_v1",e)}logout(){let e=!!sessionStorage.getItem("hv_parent_token"),t=sessionStorage.getItem("hv_parent_token");t?(sessionStorage.removeItem("hv_parent_token"),sessionStorage.setItem("hv_return_tab","users"),this.verifyToken(t),window.location.reload()):(this.token.set(null),this.currentUser.set(null),localStorage.removeItem("admin_token_v1"),this.state.setAdminAuthenticated(!1),this.router.url.includes("/admin")?this.router.navigate(["/admin"]):this.router.navigate(["login"]))}async impersonate(e){try{let t=await fetch(`/api/admin/impersonate/${e}`,{method:"POST",headers:{Authorization:`Bearer ${this.token()}`}});if(t.ok){let n=await t.json();return sessionStorage.setItem("hv_parent_token",this.token()),sessionStorage.setItem("hv_return_tab","users"),this.setSession(n.token,c(a({},this.currentUser()),{isImpersonated:!0})),!0}}catch{}return!1}isAuthenticated(){return!!this.token()}getToken(){return this.token()}static{this.\u0275fac=function(t){return new(t||s)}}static{this.\u0275prov=u({token:s,factory:s.\u0275fac,providedIn:"root"})}};export{m as a};
