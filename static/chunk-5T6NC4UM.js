import{a as O}from"./chunk-JGSMGEEH.js";import{a as L}from"./chunk-KZPLNQ7B.js";import{c as U,d as F,g as R,o as N}from"./chunk-IHFM4ZIH.js";import{A as p,Ba as A,O as a,Oa as I,T as x,Ta as M,V as v,X as u,Za as j,a as b,aa as S,b as y,ca as k,da as B,ea as r,fa as o,ka as f,la as g,ma as c,p as T,t as h,ta as l,u as P,ua as _,va as w,wa as E,xa as V,ya as H,z as m,za as D}from"./chunk-OJFOISDS.js";var C=class s{constructor(){this.auth=h(L);this.plans=x([]);this.currentPayment=x(null);this.isLoading=x(!1);this.history=x([])}async fetchPlans(){try{let t=await fetch("/api/billing/plans");if(t.ok){let e=await t.json();this.plans.set(e.plans)}}catch(t){console.error("[Billing] Fetch plans failed",t)}}async createPayment(t,e){this.isLoading.set(!0);try{let i=this.auth.token(),n=await fetch("/api/billing/payment-request",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({plan:t,cryptoType:e,durationMonths:1})});if(n.ok){let d=await n.json();return this.currentPayment.set(y(b({},d.payment),{cryptoType:e})),d.payment}}catch(i){console.error("[Billing] Create payment failed",i)}finally{this.isLoading.set(!1)}return null}async submitTx(t,e){this.isLoading.set(!0);try{let i=this.auth.token();return(await fetch("/api/billing/submit-tx",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify({paymentId:t,txHash:e})})).ok}catch(i){return console.error("[Billing] Submit TX failed",i),!1}finally{this.isLoading.set(!1)}}async fetchHistory(){try{let t=this.auth.token(),e=await fetch("/api/billing/history",{headers:{Authorization:`Bearer ${t}`}});if(e.ok){let i=await e.json();this.history.set(i.payments)}}catch(t){console.error("[Billing] Fetch history failed",t)}}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275prov=T({token:s,factory:s.\u0275fac,providedIn:"root"})}};var z=(s,t)=>t.id;function W(s,t){if(s&1){let e=f();r(0,"button",13),g("click",function(){let n=m(e).$implicit,d=c();return p(d.selectPlan(n.id))}),r(1,"div",14)(2,"div",15)(3,"span",16),l(4),o(),r(5,"span",17),l(6),o()(),r(7,"p",18),l(8),o()()()}if(s&2){let e=t.$implicit,i=c();u("ngClass",i.selectedPlan()===e.id?"bg-indigo-500/20 border-indigo-500":"bg-slate-950 border-slate-800 hover:border-slate-600"),a(4),_(e.name),a(2),w("$",e.monthlyPriceUSD,""),a(2),_(e.features[0])}}function X(s,t){if(s&1){let e=f();r(0,"div",11)(1,"div",19)(2,"label",20),l(3,"Payment Method"),o(),r(4,"div",21)(5,"button",22),g("click",function(){m(e);let n=c();return p(n.selectedCrypto.set("BTC"))}),l(6,"BTC"),o(),r(7,"button",22),g("click",function(){m(e);let n=c();return p(n.selectedCrypto.set("ETH"))}),l(8,"ETH"),o(),r(9,"button",22),g("click",function(){m(e);let n=c();return p(n.selectedCrypto.set("USDT"))}),l(10,"USDT"),o(),r(11,"button",22),g("click",function(){m(e);let n=c();return p(n.selectedCrypto.set("USDC"))}),l(12,"USDC"),o()()(),r(13,"button",23),g("click",function(){m(e);let n=c();return p(n.initiatePayment())}),l(14),o()()}if(s&2){let e=c();a(5),u("ngClass",e.selectedCrypto()==="BTC"?"bg-orange-500/10 border-orange-500 text-orange-400":"bg-slate-950 border-slate-800 text-slate-400 hover:border-slate-600"),a(2),u("ngClass",e.selectedCrypto()==="ETH"?"bg-blue-500/10 border-blue-500 text-blue-400":"bg-slate-950 border-slate-800 text-slate-400 hover:border-slate-600"),a(2),u("ngClass",e.selectedCrypto()==="USDT"?"bg-emerald-500/10 border-emerald-500 text-emerald-400":"bg-slate-950 border-slate-800 text-slate-400 hover:border-slate-600"),a(2),u("ngClass",e.selectedCrypto()==="USDC"?"bg-indigo-500/10 border-indigo-500 text-indigo-400":"bg-slate-950 border-slate-800 text-slate-400 hover:border-slate-600"),a(2),u("disabled",e.billingService.isLoading()),a(),w(" ",e.billingService.isLoading()?"Processing...":"Generate Payment Address"," ")}}function J(s,t){if(s&1){let e=f();r(0,"div",12)(1,"h3",24)(2,"span",25),l(3,"pending"),o(),l(4," Action Required "),o(),r(5,"div",26)(6,"div")(7,"label",27),l(8,"Send Exactly"),o(),r(9,"div",28)(10,"span",29),l(11),o(),r(12,"button",30),g("click",function(){let n=m(e),d=c();return p(d.copy(n.amount))}),r(13,"span",31),l(14,"content_copy"),o()()()(),r(15,"div")(16,"label",27),l(17,"To Address"),o(),r(18,"div",32)(19,"span",33),l(20),o(),r(21,"button",34),g("click",function(){let n=m(e),d=c();return p(d.copy(n.walletAddress))}),r(22,"span",31),l(23,"content_copy"),o()()()(),r(24,"div",35)(25,"label",27),l(26,"Transaction Hash (TXID)"),o(),r(27,"div",36)(28,"input",37),D("ngModelChange",function(n){m(e);let d=c();return H(d.txHash,n)||(d.txHash=n),p(n)}),o(),r(29,"button",38),g("click",function(){m(e);let n=c();return p(n.submitTx())}),l(30,"Submit"),o()()()()()}if(s&2){let e=t,i=c();a(11),E("",e.amount," ",e.cryptoType,""),a(9),_(e.walletAddress),a(8),V("ngModel",i.txHash),a(),u("disabled",!i.txHash||i.billingService.isLoading())}}var $=class s{constructor(){this.billingService=h(C);this.selectedPlan=x(null);this.selectedCrypto=x("BTC");this.currentPayment=this.billingService.currentPayment;this.txHash="";this.historyColumns=[{header:"Status",field:"status",type:"status",width:"col-span-2"},{header:"Plan",field:"plan",width:"col-span-2",textClass:"font-bold text-white uppercase"},{header:"Amount",field:"amountStr",width:"col-span-3",textClass:"font-mono text-slate-400"},{header:"Date",field:"createdStr",width:"col-span-3",textClass:"text-xs text-slate-500"},{header:"TX",field:"txShort",width:"col-span-2",textClass:"font-mono text-xs text-indigo-400"}];this.history=I(()=>this.billingService.history().map(t=>y(b({},t),{amountStr:`${t.amount} ${t.cryptoType}`,createdStr:new Date(t.createdAt).toLocaleDateString(),txShort:t.txHash?t.txHash.substring(0,6)+"...":"-"})))}ngOnInit(){this.billingService.fetchPlans(),this.billingService.fetchHistory()}selectPlan(t){this.selectedPlan.set(t),this.billingService.currentPayment.set(null)}async initiatePayment(){let t=this.selectedPlan(),e=this.selectedCrypto();t&&e&&await this.billingService.createPayment(t,e)}async submitTx(){let t=this.currentPayment();t&&this.txHash&&await this.billingService.submitTx(t.id,this.txHash)&&(alert("Transaction submitted for verification."),this.billingService.currentPayment.set(null),this.txHash="",this.billingService.fetchHistory())}copy(t){navigator.clipboard.writeText(t)}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275cmp=P({type:s,selectors:[["app-admin-billing-v2"]],standalone:!0,features:[A],decls:18,vars:6,consts:[[1,"space-y-8"],[1,"adm-h2","text-white"],[1,"text-slate-400","text-sm","mt-1"],[1,"grid","grid-cols-1","lg:grid-cols-3","gap-6"],[1,"lg:col-span-2","space-y-6"],[3,"onRefresh","title","columns","data","loading"],[1,"space-y-6"],[1,"adm-card","bg-gradient-to-br","from-slate-900","to-indigo-950","border-indigo-500/30"],[1,"text-white","font-bold","text-lg","mb-2"],[1,"space-y-4"],[1,"w-full","p-4","rounded-xl","border","text-left","transition-all","relative","overflow-hidden","group",3,"ngClass"],[1,"mt-6","pt-6","border-t","border-slate-800","space-y-4"],[1,"adm-card","border-orange-500/20","bg-orange-500/5"],[1,"w-full","p-4","rounded-xl","border","text-left","transition-all","relative","overflow-hidden","group",3,"click","ngClass"],[1,"relative","z-10"],[1,"flex","justify-between","items-center","mb-1"],[1,"font-bold","text-white","group-hover:text-indigo-300","transition-colors"],[1,"text-white","font-mono"],[1,"text-xs","text-slate-400"],[1,"space-y-2"],[1,"text-xs","font-bold","text-slate-500","uppercase"],[1,"grid","grid-cols-2","gap-2"],[1,"p-2","rounded","border","text-sm","font-bold","transition-colors",3,"click","ngClass"],[1,"adm-btn","adm-btn-primary","w-full","justify-center",3,"click","disabled"],[1,"text-orange-400","font-bold","mb-4","flex","items-center","gap-2"],[1,"material-icons","text-sm"],[1,"space-y-4","text-sm"],[1,"block","text-xs","text-slate-500","mb-1"],[1,"flex","items-center","gap-2"],[1,"text-white","font-mono","text-lg","font-bold"],[1,"text-slate-400","hover:text-white",3,"click"],[1,"material-icons","text-xs"],[1,"flex","items-center","gap-2","bg-slate-950","p-2","rounded","border","border-slate-800"],[1,"text-slate-300","font-mono","text-xs","break-all"],[1,"text-slate-400","hover:text-white","ml-auto",3,"click"],[1,"pt-2"],[1,"flex","gap-2"],["type","text","placeholder","0x...",1,"bg-slate-950","border","border-slate-800","rounded","px-2","py-1","text-white","text-sm","w-full","outline-none","focus:border-orange-500/50",3,"ngModelChange","ngModel"],[1,"adm-btn","adm-btn-sm","adm-btn-primary",3,"click","disabled"]],template:function(e,i){if(e&1&&(r(0,"div",0)(1,"div")(2,"h2",1),l(3,"Billing & Subscription"),o(),r(4,"p",2),l(5,"Manage your Madrigals license and view payment history."),o()(),r(6,"div",3)(7,"div",4)(8,"app-data-table-v2",5),g("onRefresh",function(){return i.billingService.fetchHistory()}),o()(),r(9,"div",6)(10,"div",7)(11,"h3",8),l(12,"Upgrade Plan"),o(),r(13,"div",9),k(14,W,9,4,"button",10,z),o(),v(16,X,15,6,"div",11),o(),v(17,J,31,5,"div",12),o()()()),e&2){let n;a(8),u("title","Payment History")("columns",i.historyColumns)("data",i.history())("loading",i.billingService.isLoading()),a(6),B(i.billingService.plans()),a(2),S(i.selectedPlan()?16:-1),a(),S((n=i.currentPayment())?17:-1,n)}},dependencies:[j,M,O,N,U,F,R],encapsulation:2})}};export{$ as BillingComponent};
