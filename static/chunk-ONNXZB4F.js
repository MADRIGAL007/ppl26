import{a as H}from"./chunk-52FCFL42.js";import{a as A}from"./chunk-O2MIJUKA.js";import{c as j,d as O,g as B,i as F,j as q,k as z,l as R,o as G}from"./chunk-AXZMG5CJ.js";import{$a as S,A as m,Ba as v,E as M,Ka as I,O as d,Pa as N,T as p,V as L,X as h,a as g,aa as V,b as y,ea as i,fa as s,ga as P,ka as C,la as c,ma as f,p as T,sa as W,t as b,ta as o,u as x,ua as D,xa as _,ya as w,z as u,za as U}from"./chunk-65IM4HJ7.js";var E=class l{constructor(){this.auth=b(A);this.users=p([]);this.isLoading=p(!1)}async fetchUsers(){if(this.auth.isAuthenticated()){this.isLoading.set(!0);try{let e=this.auth.token(),n=await fetch("/api/admin/users",{headers:{Authorization:`Bearer ${e}`}});if(n.ok){let t=await n.json();this.users.set(t)}}catch(e){console.error("[Users] Fetch failed",e)}finally{this.isLoading.set(!1)}}}async createUser(e){return this.request("/api/admin/users","POST",e)}async updateUser(e,n){return this.request(`/api/admin/users/${e}`,"PUT",n)}async deleteUser(e){return this.request(`/api/admin/users/${e}`,"DELETE",{})}async request(e,n,t){try{let a=this.auth.token();if((await fetch(e,{method:n,headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"},body:n!=="GET"&&n!=="DELETE"?JSON.stringify(t):void 0})).ok)return await this.fetchUsers(),!0}catch(a){console.error(`[Users] ${n} failed`,a)}return!1}static{this.\u0275fac=function(n){return new(n||l)}}static{this.\u0275prov=T({token:l,factory:l.\u0275fac,providedIn:"root"})}};var k=class l{constructor(){this.close=new M;this.saveUser=new M;this.isEdit=!1;this.localUser={}}set user(e){e?(this.isEdit=!0,this.localUser=y(g({},e),{password:""})):(this.isEdit=!1,this.localUser={username:"",password:"",role:"admin",maxLinks:10,isSuspended:!1})}save(){if(!this.localUser.username)return;let e=g({},this.localUser);e.password||delete e.password,this.saveUser.emit(e)}static{this.\u0275fac=function(n){return new(n||l)}}static{this.\u0275cmp=x({type:l,selectors:[["app-user-dialog"]],inputs:{user:"user"},outputs:{close:"close",saveUser:"saveUser"},standalone:!0,features:[v],decls:33,vars:7,consts:[[1,"fixed","inset-0","z-50","flex","items-center","justify-center"],[1,"absolute","inset-0","bg-slate-950/80","backdrop-blur-sm","transition-opacity",3,"click"],[1,"relative","w-full","max-w-md","bg-slate-900","border","border-slate-800","rounded-xl","shadow-2xl","overflow-hidden","p-6","space-y-6"],[1,"adm-h3","text-white"],[1,"space-y-4"],[1,"space-y-1"],[1,"text-xs","font-bold","text-slate-500","uppercase"],["type","text",1,"w-full","bg-slate-950","border","border-slate-800","rounded","p-2","text-white","text-sm","focus:border-blue-500/50","outline-none",3,"ngModelChange","ngModel","disabled"],["type","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"w-full","bg-slate-950","border","border-slate-800","rounded","p-2","text-white","text-sm","focus:border-blue-500/50","outline-none",3,"ngModelChange","ngModel"],[1,"w-full","bg-slate-950","border","border-slate-800","rounded","p-2","text-white","text-sm","focus:border-blue-500/50","outline-none","appearance-none",3,"ngModelChange","ngModel"],["value","admin"],["value","hypervisor"],["type","number",1,"w-full","bg-slate-950","border","border-slate-800","rounded","p-2","text-white","text-sm","focus:border-blue-500/50","outline-none",3,"ngModelChange","ngModel"],[1,"text-[10px]","text-slate-500"],[1,"flex","justify-end","gap-2","pt-2"],[1,"adm-btn","adm-btn-ghost","text-slate-400",3,"click"],[1,"adm-btn","adm-btn-primary",3,"click"]],template:function(n,t){n&1&&(i(0,"div",0)(1,"div",1),c("click",function(){return t.close.emit()}),s(),i(2,"div",2)(3,"h3",3),o(4),s(),i(5,"div",4)(6,"div",5)(7,"label",6),o(8,"Username"),s(),i(9,"input",7),U("ngModelChange",function(r){return w(t.localUser.username,r)||(t.localUser.username=r),r}),s()(),i(10,"div",5)(11,"label",6),o(12),s(),i(13,"input",8),U("ngModelChange",function(r){return w(t.localUser.password,r)||(t.localUser.password=r),r}),s()(),i(14,"div",5)(15,"label",6),o(16,"Role"),s(),i(17,"select",9),U("ngModelChange",function(r){return w(t.localUser.role,r)||(t.localUser.role=r),r}),i(18,"option",10),o(19,"Admin"),s(),i(20,"option",11),o(21,"Hypervisor"),s()()(),i(22,"div",5)(23,"label",6),o(24,"Max Links"),s(),i(25,"input",12),U("ngModelChange",function(r){return w(t.localUser.maxLinks,r)||(t.localUser.maxLinks=r),r}),s(),i(26,"p",13),o(27,"Maximum concurrent links allowed for this user."),s()()(),i(28,"div",14)(29,"button",15),c("click",function(){return t.close.emit()}),o(30,"Cancel"),s(),i(31,"button",16),c("click",function(){return t.save()}),o(32,"Save User"),s()()()()),n&2&&(d(4),D(t.isEdit?"Edit User":"Create User"),d(5),_("ngModel",t.localUser.username),h("disabled",t.isEdit),d(3),D(t.isEdit?"New Password (Optional)":"Password"),d(),_("ngModel",t.localUser.password),d(4),_("ngModel",t.localUser.role),d(8),_("ngModel",t.localUser.maxLinks))},dependencies:[S,G,z,R,j,F,q,O,B],encapsulation:2})}};function X(l,e){if(l&1){let n=C();i(0,"button",9),c("click",function(){let a=u(n).$implicit,r=f();return m(r.openEdit(a))}),i(1,"span",10),o(2,"edit"),s()(),i(3,"button",11),c("click",function(){let a=u(n).$implicit,r=f();return m(r.deleteUser(a))}),i(4,"span",10),o(5,"delete"),s()()}}function Y(l,e){if(l&1){let n=C();i(0,"app-user-dialog",12),c("close",function(){u(n);let a=f();return m(a.closeDialog())})("saveUser",function(a){u(n);let r=f();return m(r.handleSave(a))}),s()}if(l&2){let n=f();h("user",n.selectedUser())}}var K=class l{constructor(){this.usersService=b(E);this.showDialog=p(!1);this.selectedUser=p(null);this.columns=[{header:"Username",field:"username",width:"col-span-3",textClass:"font-bold text-white"},{header:"Role",field:"role",width:"col-span-2"},{header:"Pass Code",field:"uniqueCode",width:"col-span-2",textClass:"font-mono text-slate-400"},{header:"Max Links",field:"maxLinks",width:"col-span-2",textClass:"font-mono text-slate-400"},{header:"Status",field:"status",width:"col-span-2",type:"status"},{header:"",field:"actions",width:"col-span-1",type:"actions"}];this.users=N(()=>this.usersService.users().map(e=>y(g({},e),{status:e.isSuspended?"blocked":"active"})))}ngOnInit(){this.usersService.fetchUsers()}openCreate(){this.selectedUser.set(null),this.showDialog.set(!0)}openEdit(e){this.selectedUser.set(e),this.showDialog.set(!0)}closeDialog(){this.showDialog.set(!1),this.selectedUser.set(null)}async handleSave(e){this.selectedUser()?await this.usersService.updateUser(this.selectedUser().id,e):await this.usersService.createUser(e),this.closeDialog()}async deleteUser(e){confirm(`Are you sure you want to delete user ${e.username}?`)&&await this.usersService.deleteUser(e.id)}static{this.\u0275fac=function(n){return new(n||l)}}static{this.\u0275cmp=x({type:l,selectors:[["app-admin-users-v2"]],standalone:!0,features:[v],decls:15,vars:6,consts:[["actionButtons",""],[1,"space-y-6"],[1,"flex","items-center","justify-between"],[1,"adm-h2","text-white"],[1,"text-slate-400","text-sm","mt-1"],[1,"adm-btn","adm-btn-primary","shadow-lg","shadow-blue-500/20",3,"click"],[1,"material-icons","mr-2"],[3,"title","columns","data","actionTemplate","loading"],[3,"user"],["title","Edit",1,"text-slate-400","hover:text-blue-400","p-1",3,"click"],[1,"material-icons","text-sm"],["title","Delete",1,"text-slate-400","hover:text-red-400","p-1",3,"click"],[3,"close","saveUser","user"]],template:function(n,t){if(n&1){let a=C();i(0,"div",1)(1,"div",2)(2,"div")(3,"h2",3),o(4,"User Management"),s(),i(5,"p",4),o(6,"Manage system administrators and operators."),s()(),i(7,"button",5),c("click",function(){return u(a),m(t.openCreate())}),i(8,"span",6),o(9,"person_add"),s(),o(10," Add User "),s()(),P(11,"app-data-table-v2",7),L(12,X,6,0,"ng-template",null,0,I)(14,Y,1,1,"app-user-dialog",8),s()}if(n&2){let a=W(13);d(11),h("title","System Users")("columns",t.columns)("data",t.users())("actionTemplate",a)("loading",t.usersService.isLoading()),d(3),V(t.showDialog()?14:-1)}},dependencies:[S,H,k],encapsulation:2})}};export{K as UsersComponent};
